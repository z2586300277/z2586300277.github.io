import{_ as C,r as v,a as E,o as N,s as i,c as S,b as a,w as l,d as s,e as D,f as w,u as M,g as $,h as m,t as j,E as f}from"./index-D7a3-4ka.js";const I={class:"profile-page"},O={class:"avatar-section"},P={__name:"Avatar",setup(T){const p=v(!1),_=v(!1),c=v(""),t=E({email:"",nickname:"",gender:"",birthday:"",phone:"",website:"",location:"",bio:""}),g=async n=>{if(!n)return"";const{data:e}=await i.storage.from("avatars").createSignedUrl(n,3600);return e?.signedUrl||""};N(async()=>{const{data:{user:n}}=await i.auth.getUser();if(!n)return;const e=n.user_metadata||{};Object.assign(t,{email:n.email,nickname:e.nickname||"",gender:e.gender||"",birthday:e.birthday||"",phone:e.phone||"",website:e.website||"",location:e.location||"",bio:e.bio||""}),c.value=await g(e.avatar_path)});const y=async n=>{p.value=!0;try{const e=`${Date.now()}.${n.name.split(".").pop()}`,{error:r}=await i.storage.from("avatars").upload(e,n);if(r)throw r;await i.auth.updateUser({data:{avatar_path:e}}),c.value=await g(e),f.success("头像上传成功")}catch(e){f.error(e.message)}finally{p.value=!1}return!1},U=async()=>{_.value=!0;try{const{email:n,...e}=t,{error:r}=await i.auth.updateUser({data:e});if(r)throw r;f.success("保存成功")}catch(n){f.error(n.message)}finally{_.value=!1}};return(n,e)=>{const r=s("el-icon"),h=s("el-avatar"),V=s("el-button"),k=s("el-upload"),u=s("el-input"),d=s("el-form-item"),b=s("el-radio"),x=s("el-radio-group"),z=s("el-date-picker"),A=s("el-form"),B=s("el-card");return D(),S("div",I,[a(B,{class:"profile-card"},{default:l(()=>[e[12]||(e[12]=w("h2",null,"个人信息",-1)),w("div",O,[a(h,{size:100,src:c.value},{default:l(()=>[a(r,{size:50},{default:l(()=>[a(M($))]),_:1})]),_:1},8,["src"]),a(k,{"show-file-list":!1,"before-upload":y,accept:"image/*"},{default:l(()=>[a(V,{type:"primary",loading:p.value,size:"small"},{default:l(()=>[m(j(p.value?"上传中...":"更换头像"),1)]),_:1},8,["loading"])]),_:1})]),a(A,{model:t,"label-width":"80px",class:"profile-form"},{default:l(()=>[a(d,{label:"邮箱"},{default:l(()=>[a(u,{modelValue:t.email,"onUpdate:modelValue":e[0]||(e[0]=o=>t.email=o),disabled:""},null,8,["modelValue"])]),_:1}),a(d,{label:"昵称"},{default:l(()=>[a(u,{modelValue:t.nickname,"onUpdate:modelValue":e[1]||(e[1]=o=>t.nickname=o),placeholder:"请输入昵称"},null,8,["modelValue"])]),_:1}),a(d,{label:"性别"},{default:l(()=>[a(x,{modelValue:t.gender,"onUpdate:modelValue":e[2]||(e[2]=o=>t.gender=o)},{default:l(()=>[a(b,{value:"male"},{default:l(()=>[...e[8]||(e[8]=[m("男",-1)])]),_:1}),a(b,{value:"female"},{default:l(()=>[...e[9]||(e[9]=[m("女",-1)])]),_:1}),a(b,{value:"other"},{default:l(()=>[...e[10]||(e[10]=[m("保密",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"生日"},{default:l(()=>[a(z,{modelValue:t.birthday,"onUpdate:modelValue":e[3]||(e[3]=o=>t.birthday=o),type:"date",placeholder:"选择生日",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{label:"手机号"},{default:l(()=>[a(u,{modelValue:t.phone,"onUpdate:modelValue":e[4]||(e[4]=o=>t.phone=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),a(d,{label:"个人主页"},{default:l(()=>[a(u,{modelValue:t.website,"onUpdate:modelValue":e[5]||(e[5]=o=>t.website=o),placeholder:"https://example.com"},null,8,["modelValue"])]),_:1}),a(d,{label:"所在地"},{default:l(()=>[a(u,{modelValue:t.location,"onUpdate:modelValue":e[6]||(e[6]=o=>t.location=o),placeholder:"请输入所在城市"},null,8,["modelValue"])]),_:1}),a(d,{label:"个人简介"},{default:l(()=>[a(u,{modelValue:t.bio,"onUpdate:modelValue":e[7]||(e[7]=o=>t.bio=o),type:"textarea",rows:3,placeholder:"介绍一下自己"},null,8,["modelValue"])]),_:1}),a(d,null,{default:l(()=>[a(V,{type:"primary",onClick:U,loading:_.value},{default:l(()=>[...e[11]||(e[11]=[m("保存修改",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1})])}}},F=C(P,[["__scopeId","data-v-c1dbb446"]]);export{F as default};
